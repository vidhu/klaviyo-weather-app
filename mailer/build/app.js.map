{"version":3,"sources":["../src/app.js"],"names":["QUEUE_NAME","conn","undefined","amqp","connect","mailConn","sendMail","SendMail","ch","createChannel","assertQueue","durable","consume","msg","sub","JSON","parse","content","console","log","email","city","ack","process","on","close","exit"],"mappings":";;AAAA;;AACA;;;;AACA,MAAMA,UAAU,GAAG,OAAnB;AAEA,IAAIC,IAAI,GAAGC,SAAX;;AAEA,CAAC,YAAY;AACXD,EAAAA,IAAI,GAAG,MAAME,iBAAKC,OAAL,CAAa,8BAAb,CAAb;AACA,QAAMC,QAAQ,GAAG,MAAM,wBAAvB;AACA,QAAMC,QAAQ,GAAG,IAAIC,kBAAJ,CAAaF,QAAb,CAAjB;AAEA,QAAMG,EAAE,GAAG,MAAMP,IAAI,CAACQ,aAAL,EAAjB;AACAD,EAAAA,EAAE,CAACE,WAAH,CAAeV,UAAf,EAA2B;AAAEW,IAAAA,OAAO,EAAE;AAAX,GAA3B;AACAH,EAAAA,EAAE,CAACI,OAAH,CAAWZ,UAAX,EAAuB,MAAMa,GAAN,IAAa;AAClC,UAAMC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,OAAf,CAAZ;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,SAASJ,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,OAAf,EAAwBG,KAA7C;AACA,UAAMd,QAAQ,CAACA,QAAT,CAAkBQ,GAAG,CAACM,KAAtB,EAA6BN,GAAG,CAACO,IAAjC,CAAN;AACAb,IAAAA,EAAE,CAACc,GAAH,CAAOT,GAAP;AACD,GALD;AAMD,CAbD;;AAeAU,OAAO,CAACC,EAAR,CAAW,SAAX,EAAsB,YAAY;AAChC,QAAMvB,IAAI,CAACwB,KAAL,EAAN;AACAF,EAAAA,OAAO,CAACG,IAAR,CAAa,CAAb;AACD,CAHD","sourcesContent":["import amqp from 'amqplib';\nimport { connect as mailConnect, SendMail } from './SendMail';\nconst QUEUE_NAME = 'email';\n\nlet conn = undefined;\n\n(async () => {\n  conn = await amqp.connect('amqp://user:bitnami@rabbitMQ');\n  const mailConn = await mailConnect();\n  const sendMail = new SendMail(mailConn);\n\n  const ch = await conn.createChannel();\n  ch.assertQueue(QUEUE_NAME, { durable: true });\n  ch.consume(QUEUE_NAME, async msg => {\n    const sub = JSON.parse(msg.content);\n    console.log('[x] ' + JSON.parse(msg.content).email);\n    await sendMail.sendMail(sub.email, sub.city);\n    ch.ack(msg);\n  });\n})();\n\nprocess.on('SIGTERM', async () => {\n  await conn.close();\n  process.exit(0);\n});\n"],"file":"app.js"}